<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=GBK">
<title>数据存储管理</title>
<link rel="stylesheet" type="text/css" href="/newver/resources/css/ext-all.css" /> 
<style type="text/css">   
   .x-selectable, .x-selectable * {   
		-moz-user-select: text!important;   
		-khtml-user-select: text!important;   
	}  
	.csCanvas{
		position:absolute;
		min-width: 80%; 
		max-width: 100%; 
		height: 50%; 
		margin: 0 auto;
	}
	.csData{
		position:absolute;
		top:50%;
		width:100%;
		height:50%;
	}
</style>
      
<script type="text/javascript" src="/newver/resources/js/ext-all.js"></script>
<script type="text/javascript" src="http://cdn.hcharts.cn/jquery/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="/newver/chart/highcharts.js"></script>
<script type="text/javascript" src="/newver/chart/modules/funnel.js"></script>
<script type="text/javascript" src="/newver/chart/modules/exporting.js"></script>
<script type="text/javascript" src="/newver/chart/modules/drilldown.js"></script>

<script>  

Ext.require([
    'Ext.form.*',
    'Ext.data.*',
    'Ext.tip.QuickTipManager'
]);


function getData(colors){
	var data = [];
    data = [{
                y: 55.11,
                color: colors[0],
                drilldown: {
                    name: '6',
                    categories: ['聊天日志', '屏幕截图', '外设日志', '告警日志'],
                    data: [10.85, 7.35, 33.06, 2.81],
                    color: colors[0]
                }
            }, {
                y: 21.63,
                color: colors[1],
                drilldown: {
                    name: '7',
                    categories: ['聊天日志', '屏幕截图', '外设日志', '告警日志'],
                    data: [0.20, 0.83, 1.58, 13.12],
                    color: colors[1]
                }
            }, {
                y: 11.94,
                color: colors[2],
                drilldown: {
                    name: '8',
                    categories: ['聊天日志', '屏幕截图'],
                    data: [ 9.91, 0.52],
                    color: colors[2]
                }
            }, {
                y: 7.15,
                color: colors[3],
                drilldown: {
                    name: '9',
                    categories: ['聊天日志', '屏幕截图', '外设日志', '告警日志', '进程日志', '开关机日志'],
                    data: [4.55, 1.42, 0.21, 0.20, 0.19, 0.14],
                    color: colors[3]
                }
            }, {
                y: 2.14,
                color: colors[4],
                drilldown: {
                    name: '10',
                    categories: ['聊天日志', '屏幕截图', '外设日志'],
                    data: [ 0.12, 0.37, 1.65],
                    color: colors[4]
                }
            }];
    return data;
}

var colors = Highcharts.getOptions().colors,
    categories = ['6', '7', '8', '9', '10'],
    name = '月份',
    data = getData(colors);

function setChart(name, categories, data, color) {
	chart.xAxis[0].setCategories(categories, false);
	chart.series[0].remove(false);
	chart.addSeries({
		name: name,
		data: data,
		color: color || 'white'
	}, false);
	chart.redraw();
}

var chart;
function createChart(){
    chart = new Highcharts.Chart({ 
		chart: {
			type: 'column',
			renderTo: 'container'
		},
		title: {
			text: '系统数据存储情况'
		},
		subtitle: {
			text: '点击可以查看明细'
		},
		xAxis: {
			categories: categories
		},
		yAxis: {
			title: {
				text: '每月所占百分比'
			}
		},
		plotOptions: {
			column: {
				cursor: 'pointer',
				point: {
					events: {
						click: function() {
							var drilldown = this.drilldown;
							if (drilldown) { // drill down
								setChart(drilldown.name, drilldown.categories, drilldown.data, drilldown.color);
							} else { // restore
							alert("点击"+this.category);                              
							}
						}
					}
				},
				dataLabels: {
					enabled: true,
					color: colors[0],
					style: {
						fontWeight: 'bold'
					},
					formatter: function() {
					var point = this.point;
					var s = "";
					if (point.drilldown) {
						s += this.y +'%';
					} else {
						s += this.y +'MB';
					}
						return s;
					}
				}
			}
		},
		tooltip: {
			formatter: function() {
				var point = this.point,
					s = this.x +':<b>'+ this.y +'% </b><br>';
				if (point.drilldown) {
					s += '点击查看 '+ point.category+'月明细';
				} else {
					s += '点击返回';
				}
				return s;
			}
		},
		series: [{
			name: name,
			data: data,
			color: 'white'
		}],
		exporting: {
			enabled: true
		}
	});
}

Ext.onReady(function(){
	createChart();
	//chart.highcharts(); // return chart
});

function clkBack(){
	setChart(name, categories, data);
}

function clkRefresh(){
	//从后台获取数据
	Ext.Ajax.request({
			url: '/pronline/Msg?FunName@getCleanDataDetail',  
			method: 'GET',
			success: function(resp,opts){   
				try{
					var respText = resp.responseText; 
					var respRecord = eval("("+respText+")");
					categories = [];
					categories.add(respRecord.data.category);
				}catch(e){
					//console.log(e.message);
				}				
			},
			failure: function(resp,opts){   
				var respText = eval("("+respText+")");
				alert('错误', respText.error);
			}
		});
}
</script>
    
    
</head>
<body style="background-color:#DEE8FA">
	<button id="btnBack" onclick="clkBack()">返回</button>
	<button id="btnRefresh" onclick="clkRefresh()">刷新</button>
	<div id="container" class="csCanvas"></div>
	<!--div id="docbody" class="csData"></div-->
</body>
</html>
