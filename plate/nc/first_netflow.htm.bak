<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<META HTTP-EQUIV="Expires" CONTENT="0">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Jon Eyrick" CONTENT="no-cache">
<title>网络接口速率</title>
<style>
v\:*         { behavior: url(#default#VML) }
o\:*         { behavior: url(#default#VML) }
.shape       { behavior: url(#default#VML) }
TD {	FONT-SIZE: 9pt}
A:link {COLOR: #800080; TEXT-DECORATION: underline;}
A:hover{color:#800080;text-decoration:underline;
font-size:9pt;
}
</style>
<SCRIPT LANGUAGE="JavaScript">

	function openreport(t){

		window.open(t,'open_report2','height=600, width=1000, top=50, left=50,toolbar=no,scrollbars=no,resizable=1,menubar=no,status=no;');
	}	
	function openreport2(t){
		window.open(t,'open_report2','height=600, width=860, top=0, left=0,toolbar=no,scrollbars=no,resizable=1,menubar=no,status=no;');
	}
	function allselect(){
		var temp_value='';
		[#SLPB#]

		if(form1.[#dev#].checked==true){

		  temp_value=temp_value+'[[#dev#]]';
		}
		[#SLPE#]
		
	return temp_value;
   }
	
		function getColor(){
		return "rgb("+Math.round(Math.random()*255)+","+Math.round(Math.random()*255)+","+Math.round(Math.random()*255)+")";
  };
	//求数据对象的最大Value
function maxs(mm){
 var max1 = 0;

 for(var i=0; i<mm.length; i++){
  if(parseInt(mm[i]) > max1) max1 = parseInt(mm[i]);
 }
 return max1;
}
	
	
	
	
	var tb_left=50;
	var tb_top=34;
	var tb_width=280;
	var tb_height=170;
	
	var y_tot=5;
	var x_tot=7;
	var y_max=0;
	
	var dev_count=1;           //接口数
	
	var dev_desc=new Array();
	var dev_color=new Array();

	    dev_color[0]='#00ff00';
	    dev_color[1]='#f0eef0';
	    dev_color[2]='#FFff00';
	    dev_color[3]='#66FFFF';
	    dev_color[4]='#FF33CC';
	    dev_color[5]='#EDEDED';
	    dev_color[6]='#CCFF00';
	    dev_color[7]='#6B8E23';
		  dev_color[8]='#C0C0C0';
	    dev_color[9]='#FAF0E6';
	    	    
	    dev_color[10]='#00FA9A';
	    dev_color[11]='#FF0000';
	    dev_color[12]='#FFFF00';
	    dev_color[13]='#FFEBCD';
	    dev_color[14]='#00ffff';
	    dev_color[15]='#D2691E';
	    dev_color[16]='#800080';
	    dev_color[17]='#6B8E23';
		  dev_color[18]='#C0C0C0';
	    dev_color[19]='#FAF0E6';
	    
	//x轴刻度
	var sdate=new Array(480,440,400,360,320,280,240,200,160,120,80,40,0);
	
	var sdate_y0=new Array();
	var sdate_y1=new Array();
	var sdate_y2=new Array();
	var sdate_y3=new Array();
	var sdate_y4=new Array();
	var sdate_y5=new Array();
	var sdate_y6=new Array();
	var sdate_y7=new Array();
	var sdate_y8=new Array();
	var sdate_y9=new Array();
	var sdate_y10=new Array();
	var sdate_y11=new Array();
	var sdate_y12=new Array();
	var sdate_y13=new Array();
	var sdate_y14=new Array();
	var sdate_y15=new Array();
	var sdate_y16=new Array();
	var sdate_y17=new Array();
	var sdate_y18=new Array();
	var sdate_y19=new Array();
	var temp_html;
	


	
//画图

function drawgrap(){
	y_max=0;	
	
	//求数据中Y轴的最大数
	for(var i=0;i<dev_count;i++){
		var obj="sdate_y"+i;
	//	alert(maxs(eval(obj)));
		y_max2=maxs(eval(obj));
//alert('fff');		
		if(y_max2<10){
		  y_max=10;
		}
		else if(y_max2>=10&&y_max2<100){
			y_max=100;
		}
		else{
			y_max2=(100*(Math.round(maxs(eval(obj))/100)));
			y_max=1.5*y_max2;
		}
//		else if(y_max2>=100&&y_max2<1000)
//			y_max=1000;
//		else if(y_max2>=1000&&y_max2<10000)
//			y_max=10000;
//		else if(y_max2>=10000&&y_max2<100000)
//			y_max=100000;
//		else
//			y_max=y_max2;
			
//	alert(y_max);	
	//	if(y_max2>y_max) y_max=y_max2;
	}


  var t_m=y_max+'';
 
//  var gg=Math.pow(10,parseInt(t_m.length)-1);
//  var hh=Math.round(y_max/(3*gg))+1;
//  y_max=3*hh*gg;
 
  


	var yunit='Kbps';
  var step_scal=tb_height/y_tot;			
	var step=y_max/y_tot;
  x_tot=sdate.length;
	var step_x=Math.floor(tb_width/x_tot);
	
	var yzoom                //比例因子
	if(y_max==0)	
	  yzoom=1;
else
	 yzoom=tb_height/y_max;


   temp_html="<v:rect  alt='' style='position:absolute;left:"+tb_left+";top:"+tb_top+";width:"+tb_width+";height:"+tb_height+";z-index:-1' fillcolor='#000000' strokecolor='green' strokeweight='1' stroked='t'>";
   temp_html=temp_html+"</v:rect>";
   temp_html=temp_html+"<v:line  alt='' style='position:absolute;left:0;text-align:left;top:0;flip:y;z-index:-1' from='"+tb_left+","+parseInt(tb_top+tb_height)+"' to='"+parseInt(tb_left+tb_width)+","+parseInt(tb_top+tb_height)+"'/>";	 
   temp_html=temp_html+"<v:line  alt='' style='position:absolute;left:0;text-align:left;top:0;flip:y;z-index:-1' from='"+tb_left+","+tb_top+"' to='"+tb_left+","+parseInt(tb_top+tb_height)+"'/> ";
 
 //画边框  
   temp_html=temp_html+"<v:line  alt='' style='position:absolute;left:0;text-align:left;top:0;flip:y;z-index:2' from='"+parseInt(tb_left-1)+","+parseInt(tb_top-1)+"' to='"+parseInt(tb_left+tb_width+1)+","+parseInt(tb_top-1)+"'  strokecolor='green'/> ";
   temp_html=temp_html+"<v:line  alt='' style='position:absolute;left:0;text-align:left;top:0;flip:y;z-index:2' from='"+parseInt(tb_left-1)+","+parseInt(tb_top+tb_height+1)+"' to='"+parseInt(tb_left+tb_width+1)+","+parseInt(tb_top+tb_height+1)+"'  strokecolor='green'/> ";
   temp_html=temp_html+"<v:line  alt='' style='position:absolute;left:0;text-align:left;top:0;flip:y;z-index:2' from='"+parseInt(tb_left-1)+","+parseInt(tb_top-1)+"' to='"+parseInt(tb_left-1)+","+parseInt(tb_top+tb_height+1)+"'  strokecolor='green'/> "; 
   temp_html=temp_html+"<v:line  alt='' style='position:absolute;left:0;text-align:left;top:0;flip:y;z-index:2' from='"+parseInt(tb_left+tb_width+1)+","+parseInt(tb_top-1)+"' to='"+parseInt(tb_left+tb_width+1)+","+parseInt(tb_top+tb_height+1)+"'  strokecolor='green'/> ";  
      
	//画Y轴	
		var i;
		for(i=0;i<=y_tot;i++){	   
				temp_html=temp_html+"<v:line  alt='' style='position:absolute;left:0;text-align:left;top:0;flip:y;z-index:8' from='"+parseInt(tb_left)+","+parseInt(tb_top+step_scal*i)+"' to='"+parseInt(tb_left+tb_width)+","+parseInt(tb_top+step_scal*i)+"'  strokecolor='green' />	";		
	
	
			  temp_html=temp_html+"<v:shape  alt='' style='position:absolute;left:"+parseInt(tb_left-45)+";top:"+parseInt(tb_top+tb_height-i*step_scal-10)+";width:40px;height:18px;z-index:1'>";

			  temp_html=temp_html+"<table cellspacing='3' cellpadding='0' width='100%' height='100%'>";	
			  temp_html=temp_html+"<tr><td align='right'>"+i*step+"</td></tr>";
			  temp_html=temp_html+"</table></v:shape>";
					   
		}

			  temp_html=temp_html+"<v:shape  style='position:absolute;left:"+parseInt(tb_left-40)+";top:"+parseInt(tb_top+tb_height-i*step_scal+5)+";width:40px;height:18px;z-index:1'>";

			  temp_html=temp_html+"<table cellspacing='3' cellpadding='0' width='100%' height='100%'>";	
			  temp_html=temp_html+"<tr><td align='right'>"+yunit+"</td></tr>";
			  temp_html=temp_html+"</table></v:shape>";


		//画X轴

		 for(i=0;i<x_tot;i++){
		 	
		 		temp_html=temp_html+"<v:line  alt='' style='position:absolute;left:0;text-align:left;top:0;flip:y;z-index:-1' from='"+parseInt(tb_left+i*tb_width/(x_tot-1))+","+parseInt(tb_top)+"' to='"+parseInt(tb_left+i*tb_width/(x_tot-1))+","+parseInt(tb_top+tb_height)+"' strokecolor='green'/>";			
			  temp_html=temp_html+"<v:shape  alt='' style='position:absolute;left:"+parseInt(tb_left+i*tb_width/(x_tot-1)-10)+";top:"+parseInt(tb_top+tb_height+5)+";width:40px;height:18px;z-index:1'>";
			  temp_html=temp_html+"<table cellspacing='3' cellpadding='0' width='100%' height='100%' >";	
			  temp_html=temp_html+"<tr><td align='left' >"+sdate[i]+"</td></tr>";
			  temp_html=temp_html+"</table></v:shape>";
		 	
		}

	
			  temp_html=temp_html+"<v:shape  alt='' style='position:absolute;left:"+parseInt(tb_left+i*tb_width/(x_tot-1)-10)+";top:"+parseInt(tb_top+tb_height+5)+";width:40px;height:18px;z-index:1'>";
			  temp_html=temp_html+"<table cellspacing='3' cellpadding='0' width='100%' height='100%' >";	
			  temp_html=temp_html+"<tr><td align='left' > 秒</td></tr>";
			  temp_html=temp_html+"</table></v:shape>";



//画标题

   var p1;
   //画线
 var alldev=allselect();
		for(j=0;j<dev_count;j++){
			
			var indev='['+dev_desc[j]+']';
			if(alldev.indexOf(indev)!=-1){
			
			 obj="sdate_y"+j;
			var obj_y=eval(obj);
			var y_len=eval(obj).length;
			
		
			
      p1='';	
		  for(i=0;i<y_len;i++){
     if(i==0)
         p1=parseInt(tb_left+i*tb_width/(y_len-1))+','+parseInt(tb_top+tb_height-obj_y[i]*yzoom);
     else
	       p1=p1+','+parseInt(tb_left+i*tb_width/(y_len-1))+','+parseInt(tb_top+tb_height-obj_y[i]*yzoom);
	//	  	temp_html=temp_html+"<v:line style='position:absolute;left:0;text-align:left;top:0;z-index:-1' from='"+parseInt(tb_left+i*tb_width/(y_len-1))+","+parseInt(tb_top+tb_height-obj_y[i]*yzoom)+"' to='"+parseInt(tb_left+(i+1)*tb_width/(y_len-1))+","+parseInt(tb_top+tb_height-obj_y[i+1]*yzoom)+"' strokecolor='"+dev_color[j]+" '/>";

		  }
		  
		  		temp_html=temp_html+'<v:polyline style="Z-INDEX:1;LEFT:0;POSITION:absolute;TOP:0"  points=" '+p1+'" filled="f" strokecolor="'+dev_color[j]+'" />';
		  
		}
	}
//		temp_html=temp_html+'<v:polyline style="Z-INDEX:1;LEFT:0;POSITION:absolute;TOP:0" points=" '+p1+'" filled="f" strokecolor="red" fillcolor="red"/>';

   //画图例
var cur_rate='';    //当前速率
   var mmm=0;
   
   for(i=0;i<dev_count;i++){
   	if(dev_desc[i].indexOf('合计')!=-1){
   			obj="sdate_y"+i;
			var obj_i=eval(obj);
   		 cur_rate=obj_i[obj_i.length-1];
      
   
   	}
   	
   
			var indev='['+dev_desc[i]+']';
			if(alldev.indexOf(indev)!=-1){
      temp_html=temp_html+"<v:rect style='position:absolute;left:"+parseInt(tb_left+tb_width+8)+";top:"+parseInt(tb_top+mmm*22+6)+";width:16;height:12;z-index:-1' fillcolor='"+dev_color[i]+"' strokecolor='"+dev_color[i]+"' strokeweight='1' stroked='t'></v:rect>";
      
      temp_html=temp_html+"<v:shape  style='position:absolute;left:"+parseInt(tb_left+tb_width+28)+";top:"+parseInt(tb_top+mmm*22+3)+";width:60px;height:18px;z-index:1'>";

		  temp_html=temp_html+"<table cellspacing='3' cellpadding='0' width='100%' height='100%'>";	
		  temp_html=temp_html+"<tr><td align='left'>"+dev_desc[i]+"</td></tr>";
		  temp_html=temp_html+"</table></v:shape>";
		  mmm++;
     }
   }
   
   
      temp_html=temp_html+"<v:shape  style='position:absolute;left:"+parseInt(tb_left+tb_width+6)+";top:"+parseInt(tb_top+mmm*22+3)+";width:120px;height:18px;z-index:1'>";

		  temp_html=temp_html+"<table cellspacing='3' cellpadding='0' width='100%' height='100%'>";	
		  temp_html=temp_html+"<tr><td align='left'><a href='#xx' onclick=openreport('/nc_list_onlineuser_lab.htm')>即时流量排行</a></td></tr>";
		  temp_html=temp_html+"</table></v:shape>";
   
   
      temp_html=temp_html+"<v:shape  style='position:absolute;left:"+parseInt(tb_left+tb_width+6)+";top:"+parseInt(tb_top+mmm*22+25)+";width:120px;height:18px;z-index:1'>";
		  temp_html=temp_html+"<table cellspacing='3' cellpadding='0' width='100%' height='100%'>";	
		  temp_html=temp_html+"<tr><td align='left'><a href='#xx' onclick=openreport('/pronline/Msg?FunName@ncWebSortUserByFlow_75&group@W&order@F')>本周流量排行</a></td></tr>";
		  temp_html=temp_html+"</table></v:shape>";
		  
		  
		  temp_html=temp_html+"<v:shape  style='position:absolute;left:"+parseInt(tb_left+tb_width+6)+";top:"+parseInt(tb_top+mmm*22+47)+";width:120px;height:18px;z-index:1'>";
		  temp_html=temp_html+"<table cellspacing='3' cellpadding='0' width='100%' height='100%'>";	
		  temp_html=temp_html+"<tr><td align='left'><a href='#xx' onclick=openreport2('/nc_allreport.htm')>网络行为报告</a></td></tr>";
		  temp_html=temp_html+"</table></v:shape>";
   
   document.getElementById("test1").innerHTML=temp_html;

   parent.document.getElementById("currat").innerHTML='&nbsp;<font color="black">当前速率:</font><font color=red>'+cur_rate+yunit+'</font>';

  }
//alert(temp_html);


function getxmlbyname(ins,names,namee){
	var start;
	var end;
	var ret='';

	start=ins.indexOf(names);
	end=ins.indexOf(namee);
	
	if(start!=-1&&end!=-1){
		ret=ins.substr(start+names.length,end-start-names.length);
	}
	return ret;	
}




var xmlHttp = false;

 	//创建XMLHttpRequest对象       
function createXMLHttpRequest() {
	var C=null;
		if(window.XMLHttpRequest) { //Mozilla 浏览器
			C = new XMLHttpRequest();
		}
		else if (window.ActiveXObject) { // IE浏览器
			try {
				C = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try {
					C = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e) {}
			}
		}
		return C;
	}
	
	 //调用AJAX
 function callServer(e) 
 { 

  try
  {
  if( xmlHttp && xmlHttp .readyState != 0 )
   {
    xmlHttp.abort();
   }
   
   xmlHttp = createXMLHttpRequest();
   
   if( xmlHttp )
   {
   

 //   var url = "/1.htm";
 var url;
 var dev_value=allselect()
 url="/pronline/Msg?FunName@ncShowNetflowAjax&id@"+Math.random()*999;

    //打开连接
    xmlHttp.open("GET",url, true);
    //设置回调函数
    xmlHttp.onreadystatechange = updatePage;

    xmlHttp.send(null);
   }
   else
   {
//    document.getElementById("flag").innerHTML = "XMLHTTP对象创建失败";
   }
  }
  catch (e)
  {
 //  document.getElementById("flag").innerHTML = "查询错误:" + e;
  }
 }
	
	
	
	 //回调处理函数
 function updatePage() 
 {
  try {
   if (xmlHttp.readyState == 1) 
   {
//    document.getElementById("flag").innerHTML = "正在加载连接对象......";
   }

   if (xmlHttp.readyState == 2) 
   {
//    document.getElementById("flag").innerHTML = "连接对象加载完毕。";
   }

   if (xmlHttp.readyState == 3) 
   {
 //   document.getElementById("flag").innerHTML = "数据获取中......";
   }

   if (xmlHttp.readyState == 4) 
   {

    var response = xmlHttp.responseText;

   temp_unit=getxmlbyname(response,"<unit>","</unit>");
   yunit=temp_unit;
//   document.getElementById("unit").innerHTML = '单位：'+temp_unit;

    var temp_num=getxmlbyname(response,"<sum>","</sum>");

    dev_count=parseInt(temp_num);
    var temp_devdesc;
    temp_devdesc=getxmlbyname(response,"<devname>","</devname>");

    dev_desc=temp_devdesc.split("|");
  for(i=1;i<parseInt(temp_num)+1;i++){
  	  var st_name="<data_flow"+i+">";
  	  var en_name="</data_flow"+i+">";
  	  
  	  var date_name="sdate_y"+parseInt(i-1); 	  
      var temp_date=getxmlbyname(response,st_name,en_name);
      
       if(i==1)
         sdate_y0=temp_date.split("|");
       else if(i==2)
         sdate_y1=temp_date.split("|");
       else if(i==3)
       	sdate_y2=temp_date.split("|");
       else if(i==4)
       	sdate_y3=temp_date.split("|");
       else if(i==5)
       	sdate_y4=temp_date.split("|");
       else if(i==6)
       	sdate_y5=temp_date.split("|");
       else if(i==7)
       	sdate_y6=temp_date.split("|");
       else if(i==8)
       	sdate_y7=temp_date.split("|");
       else if(i==9)
       	sdate_y8=temp_date.split("|");
       else if(i==10)
       	sdate_y9=temp_date.split("|");
      else if(i==11)
       	sdate_y10=temp_date.split("|");
      else if(i==12)
       	sdate_y11=temp_date.split("|");
      else if(i==13)
       	sdate_y12=temp_date.split("|");
       else if(i==14)
       	sdate_y13=temp_date.split("|");
       else if(i==15)
       	sdate_y14=temp_date.split("|");
      else if(i==16)
       	sdate_y15=temp_date.split("|");
      else if(i==17)
       	sdate_y16=temp_date.split("|"); 	
      else if(i==18)
       	sdate_y17=temp_date.split("|");
      else if(i==19)
       	sdate_y18=temp_date.split("|"); 
  }
  

     drawgrap();


   }
  }
  catch (e) 
  {
 //     document.getElementById("flag").innerHTML = "回调处理错误:" + e;
  }
 }
	
	
	
	
	
	
</script>	
	
	
	


</head>
<body topmargin=5 leftmargin=0 style="overflow:hidden" bgcolor="#ffffff" onload="callServer(this);setInterval('callServer(this)',4000)">
	 <form name="form1" method="post" action="/pronline/Msg">
	<p align="left" style="font-size:9pt" id="ctile">
		<span style="width:42">&nbsp;</span>
		
	[#SLPB#]
	<span  style="display:[#display#]">
		<input type="checkbox" name="[#dev#]" value="[#dev#]"  [#checked#] >[#dev#]</span>
	[#SLPE#]

	
	</p>
</form>
	<div id="test1" >
	
   </div>

</body>